/* * Copyright © 2020-2021 wlei * Released under the MIT License. */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).poper=t()}(this,(function(){"use strict";var e={name:"SlPoper",props:{position:{type:String,default:"top"},styleSetting:{type:Object,default:function(){return{}}},offset:{type:Number,default:10},trigger:{type:String,default:"mouseover"},showPoper:{type:Boolean,default:!0}},data:function(){return{styleObj:{visibility:"hidden"},arrowStyleObj:{visibility:"hidden"},timer:null,isMouseOnPoper:!1}},computed:{},mounted:function(){var e=this,t=this.$refs.pop,r=this.$refs.slpopper;this.getParentDoms(r).forEach((function(t){t.addEventListener("scroll",(function(){"visible"===e.styleObj.visibility&&e.isMouseOnPoper&&e.setPopStyle()}))})),"click"===this.trigger&&document.addEventListener("click",(function(t){var n=e.getParentDoms(t.target);n.unshift(t.target);for(var o=!0,i=0;i<n.length;i++)if(n[i]===r){o=!1;break}o&&e.removeStyle()})),"mouseover"===this.trigger&&(r.addEventListener("mouseout",(function(t){t.stopPropagation(),e.mouseOut()})),t.addEventListener("mouseout",(function(t){t.stopPropagation(),e.mouseOut()})))},methods:{mouseOn:function(){this.showPoper&&(this.isMouseOnPoper=!0,this.setPopStyle())},mouseOut:function(){this.showPoper&&(this.isMouseOnPoper=!1,this.removeStyle())},setPopStyle:function(){this.timer&&clearTimeout(this.timer);var e=this.position,t={},r=this.styleSetting,n=r.color,o=void 0===n?"black":n,i=r.border,s=void 0===i?"none":i,p=r.borderRadius,a=void 0===p?"6px":p,l=r.boxShadow,c=void 0===l?"0 0 10px #d6d6d6":l,d=r.background,h=void 0===d?"white":d,u=document.documentElement.clientHeight||document.body.clientHeight,f=document.documentElement.clientWidth||document.body.clientWidth,b=this.$refs.pop.getBoundingClientRect(),m=b.height,g=b.width,y=this.$refs.slpopper.getBoundingClientRect(),v=y.left,O=y.right,A=y.top,x=y.bottom,w=y.height,j=y.width;e=this.reSetPosition(e,g,v,O,m,x,A,u,f),t.color=o,t.border=s,t.borderRadius=a,t.boxShadow=c,t.background=h;var P=this.getObjPosition(u,f,e,A,w,v,j,m,g);this.styleObj=Object.assign({visibility:"visible"},t,P);var S=this.$refs.arrow.getBoundingClientRect(),k=S.height,C=S.width,R=this.getObjPosition(u,f,e,A,w,v,j,k,C);switch(e){case"left":R.transform="translateX(50%) rotate(45deg)",R.borderTop="".concat(s),R.borderRight="".concat(s);break;case"right":R.transform="translateX(-50%) rotate(45deg)",R.borderLeft="".concat(s),R.borderBottom="".concat(s);break;case"top":R.transform="translateY(50%) rotate(45deg)",R.borderBottom="".concat(s),R.borderRight="".concat(s);break;case"bottom":R.transform="translateY(-50%) rotate(45deg)",R.borderTop="".concat(s),R.borderLeft="".concat(s)}R.background=h,this.arrowStyleObj=R},reSetPosition:function(e,t,r,n,o,i,s,p,a){return"left"===e&&t+this.offset>r&&(e="right"),"right"===e&&n+t+this.offset>a&&(e="left"),"top"===e&&o+this.offset>s&&(e="bottom"),"bottom"===e&&i+o+this.offset>p&&(e="top"),e},getObjPosition:function(e,t,r,n,o,i,s,p,a){var l,c=n-p/2+o/2,d=c<=0?0:c>e-p?e-p:c,h=t-i+this.offset,u={right:(h<=0?0:h)+"px",top:d+"px"},f=i+s+this.offset,b={left:(f<=0?0:f)+"px",top:d+"px"},m=i-a/2+s/2,g=m<=0?0:m>t-a?t-a:m,y=e-n+this.offset,v={bottom:(y<=0?0:y)+"px",left:g+"px"},O=n+o+this.offset,A={top:(O<=0?0:O)+"px",left:g+"px"};switch(r){case"left":l=u;break;case"right":l=b;break;case"top":l=v;break;case"bottom":l=A;break;default:l={}}return l},removeStyle:function(){var e=this;this.timer=setTimeout((function(){e.styleObj=Object.assign({},e.styleObj,{visibility:"hidden"}),e.arrowStyleObj=Object.assign({},e.arrowStyleObj,{visibility:"hidden"})}),100)},getParentDoms:function(e){for(var t=e.parentNode,r=[];null!==t;)r.push(t),t=t.parentNode;return r}}};function t(e,t,r,n,o,i,s,p,a,l){"boolean"!=typeof s&&(a=p,p=s,s=!1); var c="function"==typeof r?r.options:r;let d;if(e&&e.render&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),n&&(c._scopeId=n),i?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,a(e)),e&&e._registeredComponents&&e._registeredComponents.add(i)},c._ssrRegister=d):t&&(d=s?function(e){t.call(this,l(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,p(e))}),d)if(c.functional){ var e=c.render;c.render=function(t,r){return d.call(r),e(t,r)}}else{ var e=c.beforeCreate;c.beforeCreate=e?[].concat(e,d):[d]}return r} var r="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function n(e){return(e,t)=>function(e,t){ var n=r?t.media||"default":e,s=i[n]||(i[n]={ids:new Set,styles:[]});if(!s.ids.has(e)){s.ids.add(e);let r=t.source;if(t.map&&(r+="\n/*# sourceURL="+t.map.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),s.element||(s.element=document.createElement("style"),s.element.type="text/css",t.media&&s.element.setAttribute("media",t.media),void 0===o&&(o=document.head||document.getElementsByTagName("head")[0]),o.appendChild(s.element)),"styleSheet"in s.element)s.styles.push(r),s.element.styleSheet.cssText=s.styles.filter(Boolean).join("\n");else{ var e=s.ids.size-1,t=document.createTextNode(r),n=s.element.childNodes;n[e]&&s.element.removeChild(n[e]),n.length?s.element.insertBefore(t,n[e]):s.element.appendChild(t)}}}(e,t)}let o; var i={}; var s=e;var p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"slpopper",staticClass:"sl-popper",on:e._d({},[e.trigger,function(t){return e.mouseOn(t)}])},[r("div",{ref:"pop",staticClass:"pop",style:e.styleObj,on:e._d({},[e.trigger,function(t){return t.stopPropagation(),e.mouseOn(t)}])},[e._t("pop")],2),e._v(" "),r("div",{ref:"arrow",staticClass:"arrow",style:e.arrowStyleObj}),e._v(" "),e._t("default")],2)};p._withStripped=!0; var a=t({render:p,staticRenderFns:[]},(function(e){e&&e("data-v-54301b32_0",{source:".sl-popper[data-v-54301b32] {\n  display: inline-block;\n}\n.sl-popper .pop[data-v-54301b32] {\n  display: table;\n  position: fixed;\n  z-index: 9999;\n  padding: 10px;\n  user-select: text;\n}\n.sl-popper .arrow[data-v-54301b32] {\n  display: table;\n  position: fixed;\n  z-index: 9999;\n  width: 8px;\n  height: 8px;\n  transform-origin: center center;\n}\n\n/*# sourceMappingURL=main.vue.map */",map:{version:3,sources:["E:\\code\\font-code\\lerna-repo\\packages\\starlinke-components\\packages\\poper\\src\\main.vue","main.vue"],names:[],mappings:"AA4QA;EACA,qBAAA;AC3QA;AD4QA;EACA,cAAA;EACA,eAAA;EACA,aAAA;EACA,aAAA;EACA,iBAAA;AC1QA;AD4QA;EACA,cAAA;EACA,eAAA;EACA,aAAA;EACA,UAAA;EACA,WAAA;EACA,+BAAA;AC1QA;;AAEA,mCAAmC",file:"main.vue",sourcesContent:["<template>\r\n  <div\r\n    ref=\"slpopper\"\r\n    class=\"sl-popper\"\r\n    @[trigger]=\"mouseOn($event)\"\r\n  >\r\n    <div\r\n      ref=\"pop\"\r\n      class=\"pop\"\r\n      :style=\"styleObj\"\r\n      @[trigger].stop=\"mouseOn\"\r\n    >\r\n      <slot name=\"pop\" />\r\n    </div>\r\n\r\n    <div\r\n      ref=\"arrow\"\r\n      class=\"arrow\"\r\n      :style=\"arrowStyleObj\"\r\n    />\r\n    <slot />\r\n  </div>\r\n</template>\r\n<script>\r\nexport default {\r\n  name: 'SlPoper',\r\n  props: {\r\n    position: {\r\n      type: String,\r\n      default: 'top' // top,left,bottom,right\r\n    },\r\n    styleSetting: {\r\n      // 样式设置，如：{ borderRadius = '6px', background = 'white' }\r\n      type: Object,\r\n      default: function() {\r\n        return {}\r\n      }\r\n    },\r\n    offset: {\r\n      // 气泡的偏移值\r\n      type: Number,\r\n      default: 10\r\n    },\r\n    trigger: {\r\n      type: String,\r\n      default: 'mouseover' // mouseover,click\r\n    },\r\n    showPoper: {\r\n      type: Boolean,\r\n      default: true\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      styleObj: { visibility: 'hidden' },\r\n      arrowStyleObj: { visibility: 'hidden' },\r\n      timer: null,\r\n      isMouseOnPoper: false\r\n    }\r\n  },\r\n  computed: {},\r\n  mounted() {\r\n    let popDom = this.$refs.pop\r\n    let slPoperDom = this.$refs.slpopper\r\n\r\n    let parentDoms = this.getParentDoms(slPoperDom)\r\n    parentDoms.forEach((p) => {\r\n      p.addEventListener('scroll', () => {\r\n        if (this.styleObj.visibility === 'visible' && this.isMouseOnPoper) {\r\n          this.setPopStyle()\r\n        }\r\n      })\r\n    })\r\n    if (this.trigger === 'click') {\r\n      document.addEventListener('click', (e) => {\r\n        let parents = this.getParentDoms(e.target)\r\n        parents.unshift(e.target)\r\n        let canRemove = true\r\n        for (let i = 0; i < parents.length; i++) {\r\n          if (parents[i] === slPoperDom) {\r\n            canRemove = false\r\n            break\r\n          }\r\n        }\r\n        if (canRemove) this.removeStyle()\r\n      })\r\n    }\r\n    if (this.trigger === 'mouseover') {\r\n      slPoperDom.addEventListener('mouseout', (e) => {\r\n        e.stopPropagation()\r\n        this.mouseOut()\r\n      })\r\n      popDom.addEventListener('mouseout', (e) => {\r\n        e.stopPropagation()\r\n        this.mouseOut()\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    // 求取popper的位置\r\n    mouseOn() {\r\n      if (!this.showPoper) return\r\n      this.isMouseOnPoper = true\r\n      this.setPopStyle()\r\n    },\r\n    mouseOut() {\r\n      if (!this.showPoper) return\r\n      this.isMouseOnPoper = false\r\n      this.removeStyle()\r\n    },\r\n    setPopStyle() {\r\n      if (this.timer) clearTimeout(this.timer)\r\n      let position = this.position\r\n      let style = {}\r\n      let {\r\n        color = 'black',\r\n        border = 'none',\r\n        borderRadius = '6px',\r\n        boxShadow = '0 0 10px #d6d6d6',\r\n        background = 'white'\r\n      } = this.styleSetting\r\n\r\n      // 获取视窗宽、高\r\n      let ch = document.documentElement.clientHeight || document.body.clientHeight\r\n      let cw = document.documentElement.clientWidth || document.body.clientWidth\r\n      // 获取气泡的宽、高\r\n      let popDom = this.$refs.pop\r\n      let { height: popH, width: popW } = popDom.getBoundingClientRect()\r\n      // 获取content内容区的信息\r\n      let slPoperDom = this.$refs.slpopper\r\n      let slPoperDomRect = slPoperDom.getBoundingClientRect()\r\n      let {\r\n        left: rectL,\r\n        right: rectR,\r\n        top: rectT,\r\n        bottom: rectB,\r\n        height: rectH,\r\n        width: rectW\r\n      } = slPoperDomRect\r\n\r\n      // 设置气泡的显示方位\r\n      position = this.reSetPosition(position, popW, rectL, rectR, popH, rectB, rectT, ch, cw)\r\n\r\n      style.color = color\r\n      style.border = border\r\n      style.borderRadius = borderRadius\r\n      style.boxShadow = boxShadow\r\n      style.background = background\r\n      // 获取气泡的fixed定位的位置 top,left,right,bottom\r\n      let pObj = this.getObjPosition(ch, cw, position, rectT, rectH, rectL, rectW, popH, popW)\r\n      this.styleObj = Object.assign({ visibility: 'visible' }, style, pObj)\r\n\r\n      // 获取箭头的宽、高\r\n      let arrowDom = this.$refs.arrow\r\n      let { height: arrowH, width: arrowW } = arrowDom.getBoundingClientRect()\r\n      // 获取气泡的fixed定位的位置 top,left,right,bottom\r\n      let aObj = this.getObjPosition(ch, cw, position, rectT, rectH, rectL, rectW, arrowH, arrowW)\r\n      switch (position) {\r\n        case 'left':\r\n          aObj.transform = 'translateX(50%) rotate(45deg)'\r\n          aObj.borderTop = `${border}`\r\n          aObj.borderRight = `${border}`\r\n          break\r\n        case 'right':\r\n          aObj.transform = 'translateX(-50%) rotate(45deg)'\r\n          aObj.borderLeft = `${border}`\r\n          aObj.borderBottom = `${border}`\r\n          break\r\n        case 'top':\r\n          aObj.transform = 'translateY(50%) rotate(45deg)'\r\n          aObj.borderBottom = `${border}`\r\n          aObj.borderRight = `${border}`\r\n          break\r\n        case 'bottom':\r\n          aObj.transform = 'translateY(-50%) rotate(45deg)'\r\n          aObj.borderTop = `${border}`\r\n          aObj.borderLeft = `${border}`\r\n          break\r\n        default:\r\n          break\r\n      }\r\n      aObj.background = background\r\n      this.arrowStyleObj = aObj\r\n    },\r\n\r\n    // 设置气泡的显示方位\r\n    reSetPosition(position, popW, rectL, rectR, popH, rectB, rectT, ch, cw) {\r\n      if (position === 'left' && popW + this.offset > rectL) {\r\n        position = 'right'\r\n      }\r\n      if (position === 'right' && rectR + popW + this.offset > cw) {\r\n        position = 'left'\r\n      }\r\n      if (position === 'top' && popH + this.offset > rectT) {\r\n        position = 'bottom'\r\n      }\r\n      if (position === 'bottom' && rectB + popH + this.offset > ch) {\r\n        position = 'top'\r\n      }\r\n      return position\r\n    },\r\n\r\n    // 获取气泡和箭头的fixed定位的位置，气泡必须始终显示在视窗内\r\n    getObjPosition(ch, cw, position, rectT, rectH, rectL, rectW, popH, popW) {\r\n      // Y轴偏移量\r\n      let ty = rectT - popH / 2 + rectH / 2\r\n      let py = ty <= 0 ? 0 : ty > ch - popH ? ch - popH : ty\r\n      // 在左侧显示\r\n      let or = cw - rectL + this.offset\r\n      let pLeft = { right: (or <= 0 ? 0 : or) + 'px', top: py + 'px' }\r\n      // 在右侧显示\r\n      let ol = rectL + rectW + this.offset\r\n      let pRight = { left: (ol <= 0 ? 0 : ol) + 'px', top: py + 'px' }\r\n\r\n      // X轴偏移量\r\n      let tx = rectL - popW / 2 + rectW / 2\r\n      let px = tx <= 0 ? 0 : tx > cw - popW ? cw - popW : tx\r\n      // 在上方显示\r\n      let ob = ch - rectT + this.offset\r\n      let pTop = { bottom: (ob <= 0 ? 0 : ob) + 'px', left: px + 'px' }\r\n      // 在下方显示\r\n      let ot = rectT + rectH + this.offset\r\n      let pBottom = { top: (ot <= 0 ? 0 : ot) + 'px', left: px + 'px' }\r\n\r\n      let pObj\r\n\r\n      switch (position) {\r\n        case 'left':\r\n          pObj = pLeft\r\n          break\r\n        case 'right':\r\n          pObj = pRight\r\n          break\r\n        case 'top':\r\n          pObj = pTop\r\n          break\r\n        case 'bottom':\r\n          pObj = pBottom\r\n          break\r\n        default:\r\n          pObj = {}\r\n          break\r\n      }\r\n\r\n      return pObj\r\n    },\r\n\r\n    // 鼠标移出后，隐藏气泡和箭\r\n    removeStyle() {\r\n      this.timer = setTimeout(() => {\r\n        this.styleObj = Object.assign({}, this.styleObj, { visibility: 'hidden' })\r\n        this.arrowStyleObj = Object.assign({}, this.arrowStyleObj, { visibility: 'hidden' })\r\n      }, 100)\r\n    },\r\n\r\n    getParentDoms(element) {\r\n      let current = element.parentNode\r\n      let parentDoms = []\r\n      while (current !== null) {\r\n        parentDoms.push(current)\r\n        current = current.parentNode\r\n      }\r\n      return parentDoms\r\n    }\r\n  }\r\n}\r\n<\/script>\r\n<style lang=\"scss\" scoped>\r\n.sl-popper {\r\n  display: inline-block;\r\n  .pop {\r\n    display: table;\r\n    position: fixed;\r\n    z-index: 9999;\r\n    padding: 10px;\r\n    user-select: text;\r\n  }\r\n  .arrow {\r\n    display: table;\r\n    position: fixed;\r\n    z-index: 9999;\r\n    width: 8px;\r\n    height: 8px;\r\n    transform-origin: center center;\r\n  }\r\n}\r\n</style>\r\n",".sl-popper {\n  display: inline-block;\n}\n.sl-popper .pop {\n  display: table;\n  position: fixed;\n  z-index: 9999;\n  padding: 10px;\n  user-select: text;\n}\n.sl-popper .arrow {\n  display: table;\n  position: fixed;\n  z-index: 9999;\n  width: 8px;\n  height: 8px;\n  transform-origin: center center;\n}\n\n/*# sourceMappingURL=main.vue.map */"]},media:void 0})}),s,"data-v-54301b32",!1,void 0,!1,n,void 0,void 0);return a.install=function(e){e.component(a.name,a)},a}));
